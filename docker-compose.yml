version: '3.8'

services:
  # 1. Database Service (PostgreSQL)
  db:
    image: postgres:15-alpine
    container_name: lunch_db
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password
      POSTGRES_DB: lunch_rec
    ports:
      - "5432:5432"
    volumes:
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql

  # 2. Cache Service (Redis)
  cache:
    image: redis:7-alpine
    container_name: lunch_cache
    ports:
      - "6379:6379"

  # 3. Application Logic (Python Runner)
  app:
    build: 
      context: ./src
      dockerfile: Dockerfile
    container_name: lunch_app
    environment:
      DB_HOST: db
      DB_NAME: lunch_rec
      DB_USER: admin
      DB_PASS: password
      REDIS_HOST: cache
    depends_on:
      - db
      - cache